<!DOCTYPE html>
<html lang="en">
<head>
    <title>To Do Decentralized Application</title>
    <script src="main.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.1.umd.min.js"
        type="application/javascript"></script>
        <script src="https://cdn.jsdelivr.net/npm/web3@1.3.6/dist/web3.min.js" defer></script>
	<title>Centered Form</title>
	<link rel="stylesheet" href="./CSS/ListVoters.css">

</head>
<body>
    <div class = "navbar">
        <a href="/index.html">Bầu Cử</a>
        <a href="/ListVoters.html">Danh Sách Bầu Cử</a>
    </div>
    <div class="container"><h1>Chào Mừng Đến Với Group 10</h1></div>
    <div class="Btn">   
        <button onclick="connectMetamask()">Kết nối Ví MetaMask</button>
        <p id="metamasknotification"></p>
    </div>
    <div class="container">
        <h3>Thêm Ứng Cử Viên</h3>
        <input type="text" id="candidateName" placeholder="Tên của ứng cử Viên ...">
        <button onclick="addCandidate()">Thêm Ứng Cử Viên</button>
    </div>

    <div>
        <p id= "votingStatus"></p>
    </div>

    <div class="Btn">
        <button onclick="getAllCandidates()">Danh Sách Ứng Cử</button>
        <p id="p3"></p>
    </div>

    <div>
      <table id="myTable">
          <thead>
              <tr>
                  <th>Số thứ tự</th>
                  <th>Tên của Ứng Cử Viên</th>
                  <th>Số Phiếu Bầu</th>
              </tr>
          </thead>
          <tbody>

          </tbody>
      </table>
  </div>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Connect to the local Ethereum node
            if (window.ethereum) {
                window.web3 = new Web3(window.ethereum);
                await window.ethereum.enable();
                web3.eth.defaultAccount = '0xB59809455221a0d841a54AbDEA6F4e3460a63C5F'; // Set the default account
            } else if (window.web3) {
                window.web3 = new Web3(window.web3.currentProvider);
            } else {
                console.error('Non-Ethereum browser detected. You should consider trying MetaMask!');
            }
        
            // Set the contract address and ABI
            const contractAddress = '0x75556d4ad07971ca05fa89345d6565792bfc21d1';
            const contractABI = [
            {
              "inputs": [
                {
                  "internalType": "string[]",
                  "name": "_candidateNames",
                  "type": "string[]"
                },
                {
                  "internalType": "uint256",
                  "name": "_durationInMinutes",
                  "type": "uint256"
                }
              ],
              "stateMutability": "nonpayable",
              "type": "constructor"
            },
            {
              "inputs": [
                {
                  "internalType": "string",
                  "name": "_name",
                  "type": "string"
                }
              ],
              "name": "addCandidate",
              "outputs": [],
              "stateMutability": "nonpayable",
              "type": "function"
            },
            {
              "inputs": [
                {
                  "internalType": "uint256",
                  "name": "",
                  "type": "uint256"
                }
              ],
              "name": "candidates",
              "outputs": [
                {
                  "internalType": "string",
                  "name": "name",
                  "type": "string"
                },
                {
                  "internalType": "uint256",
                  "name": "voteCount",
                  "type": "uint256"
                }
              ],
              "stateMutability": "view",
              "type": "function"
            },
            {
              "inputs": [],
              "name": "getAllVotesOfCandiates",
              "outputs": [
                {
                  "components": [
                    {
                      "internalType": "string",
                      "name": "name",
                      "type": "string"
                    },
                    {
                      "internalType": "uint256",
                      "name": "voteCount",
                      "type": "uint256"
                    }
                  ],
                  "internalType": "struct Voting.Candidate[]",
                  "name": "",
                  "type": "tuple[]"
                }
              ],
              "stateMutability": "view",
              "type": "function"
            },
            {
              "inputs": [],
              "name": "getRemainingTime",
              "outputs": [
                {
                  "internalType": "uint256",
                  "name": "",
                  "type": "uint256"
                }
              ],
              "stateMutability": "view",
              "type": "function"
            },
            {
              "inputs": [],
              "name": "getVotingStatus",
              "outputs": [
                {
                  "internalType": "bool",
                  "name": "",
                  "type": "bool"
                }
              ],
              "stateMutability": "view",
              "type": "function"
            },
            {
              "inputs": [
                {
                  "internalType": "uint256",
                  "name": "_candidateIndex",
                  "type": "uint256"
                }
              ],
              "name": "vote",
              "outputs": [],
              "stateMutability": "nonpayable",
              "type": "function"
            },
            {
              "inputs": [
                {
                  "internalType": "address",
                  "name": "",
                  "type": "address"
                }
              ],
              "name": "voters",
              "outputs": [
                {
                  "internalType": "bool",
                  "name": "",
                  "type": "bool"
                }
              ],
              "stateMutability": "view",
              "type": "function"
            },
            {
              "inputs": [],
              "name": "votingEnd",
              "outputs": [
                {
                  "internalType": "uint256",
                  "name": "",
                  "type": "uint256"
                }
              ],
              "stateMutability": "view",
              "type": "function"
            },
            {
              "inputs": [],
              "name": "votingStart",
              "outputs": [
                {
                  "internalType": "uint256",
                  "name": "",
                  "type": "uint256"
                }
              ],
              "stateMutability": "view",
              "type": "function"
            }
          ];
        
            // Create a contract instance
            const contract = new web3.eth.Contract(contractABI, contractAddress);
        
            // Function to add a candidate
            window.addCandidate = async () => {
                const candidateName = document.getElementById('candidateName').value;
        
                // Call the addCandidate function from the smart contract
                await contract.methods.addCandidate(candidateName).send({ from: web3.eth.defaultAccount });
        
                // You may want to update the UI or perform other actions after adding a candidate
            };
        });
    </script>
</body>
</html>